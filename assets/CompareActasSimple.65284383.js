import{r as s,a as Q,j as c}from"./app.0c0d104d.js";import{P as E,C as N,I as R}from"./CompareImages.d6adb3f5.js";import{Q as j}from"./qr-scanner.min.caaa3552.js";import{a as z}from"./data.cf941f40.js";import"./buttons.98761dc5.js";var U=L=>{var x,w,I,M;const f=()=>{const t=localStorage.getItem("state");return t==null||t==""?null:JSON.parse(t)},[d,A]=s.exports.useState((w=(x=f())==null?void 0:x.state)!=null?w:"prepare"),[h,J]=s.exports.useState((M=(I=f())==null?void 0:I.anchors)!=null?M:[]);s.exports.useEffect(()=>{localStorage.setItem("state",JSON.stringify({state:d,anchors:h}))},[d,h]);const[e,i]=s.exports.useState({left:null,right:null}),[O,g]=s.exports.useState(null),[u,p]=s.exports.useState(null),[m,y]=s.exports.useState(null),C=t=>{const l=t.split("!")[0],[a,o,n]=l.split(".").map(r=>parseInt(r)),v=z.find(r=>parseInt(r.Centro)==a&&parseInt(r.Mesa)==o);if(v==null){p(`Lo sient, no tengo la acta por centro ${a}, mesa ${o}`);return}g("Loading same acta from resultadosconvzla.com..."),R.load(v.url.replace("https://static.resultadosconvzla.com","http://localhost:8000/static")).then(r=>{i({...e,right:r})})},S=async(t,l)=>{p(null),g("Reading QR code...");const a=t.height>t.width?{x:0,y:Math.floor(t.height-t.height/8),width:t.width,height:Math.floor(t.height/8)}:{x:Math.floor(t.width-t.width/8),y:0,width:Math.floor(t.width/8),height:t.height},o=t.crop(a).resize({width:600});y(o),j.scanImage(await o.toBlob(),{}).then(n=>{C(n)}).catch(n=>{l<4?S(t.rotate(90),l+1):p(n.toString())})};return s.exports.useEffect(()=>{(e==null?void 0:e.left)!=null&&e.right==null&&S(e==null?void 0:e.left,1)},[e]),Q("div",{className:"p-3 text-center",children:[u&&c("div",{className:"p-3",children:u}),e.left==null&&c(E,{existing:null,full:!0,onSelect:async t=>{i({left:t,right:null})}}),u!=null&&m!=null&&c("img",{width:400,src:m.toDataURL()}),e.left!=null&&e.right!=null&&c(N,{left:e.left,right:e.right,anchors:h,edit:()=>{i({left:null,right:null})}})]})};export{U as default};
