import{r as v,a as b,j as d,F as J}from"./app.cacf5c9b.js";import{P as Y,C as ie,p as V}from"./CompareImages.db12a66f.js";import{_ as A,i as re,a as H,c as I,S as j,A as ae,b as G,d as q,D as z,e as O,f as Z,g as X,h as oe,V as le,j as se,k as ce,l as he,M as de,m as ue,n as me,o as fe,p as Q,q as ve,r as ge,s as pe,t as Se,E as ye,u as Pe,I as D,v as Ee,B as w}from"./buttons.e6d49ef2.js";function xe(n,a,e){return e===void 0&&(e=function(t,i){return t===i}),n==null&&a==null?!0:n==null||a==null||n.length!==a.length?!1:n.every(function(t,i){return e(t,a[i])})}function we(n){return typeof n=="function"}var B={FULL:"full",START:"start",END:"end"},$={LOCK:"lock",PUSH:"push",NONE:"none"};function N(n){return"".concat((n*100).toFixed(2),"%")}function W(n,a,e,t){for(var i=a<e?1:-1,r=a;r!==e+i;r+=i)n[r]=t}function be(n,a){if(n.length!==0){for(var e=n[0],t=a(e),i=1;i<n.length;i++){var r=n[i],o=a(r);o<t&&(e=r,t=o)}return e}}var ke=["max","min","stepSize","tickSize","value"],Me=function(n){A(a,n);function a(){var e=n!==null&&n.apply(this,arguments)||this;return e.state={isMoving:!1},e.handleElement=null,e.refHandlers={handle:function(t){return e.handleElement=t}},e.beginHandleMovement=function(t){document.addEventListener("mousemove",e.handleHandleMovement),document.addEventListener("mouseup",e.endHandleMovement),e.setState({isMoving:!0}),e.changeValue(e.clientToValue(e.mouseEventClientOffset(t)))},e.beginHandleTouchMovement=function(t){document.addEventListener("touchmove",e.handleHandleTouchMovement),document.addEventListener("touchend",e.endHandleTouchMovement),document.addEventListener("touchcancel",e.endHandleTouchMovement),e.setState({isMoving:!0}),e.changeValue(e.clientToValue(e.touchEventClientOffset(t)))},e.getStyleProperties=function(){if(e.handleElement==null)return{};var t=e.props,i=t.min,r=i===void 0?0:i,o=t.tickSizeRatio,l=t.value,c=t.vertical,u=e.getHandleMidpointAndOffset(e.handleElement,!0).handleMidpoint,s=(l-r)*o,m="calc(".concat(N(s)," - ").concat(u,"px)");return c?{bottom:m}:{left:m}},e.endHandleMovement=function(t){e.handleMoveEndedAt(e.mouseEventClientOffset(t))},e.endHandleTouchMovement=function(t){e.handleMoveEndedAt(e.touchEventClientOffset(t))},e.handleMoveEndedAt=function(t){var i,r;e.removeDocumentEventListeners(),e.setState({isMoving:!1});var o=e.changeValue(e.clientToValue(t));(r=(i=e.props).onRelease)===null||r===void 0||r.call(i,o)},e.handleHandleMovement=function(t){e.handleMovedTo(e.mouseEventClientOffset(t))},e.handleHandleTouchMovement=function(t){e.handleMovedTo(e.touchEventClientOffset(t))},e.handleMovedTo=function(t){e.state.isMoving&&!e.props.disabled&&e.changeValue(e.clientToValue(t))},e.handleKeyDown=function(t){var i=e.props,r=i.stepSize,o=i.value,l=t.key;l==="ArrowDown"||l==="ArrowLeft"?(e.changeValue(o-r),t.preventDefault()):(l==="ArrowUp"||l==="ArrowRight")&&(e.changeValue(o+r),t.preventDefault())},e.handleKeyUp=function(t){var i,r;re(t)&&((r=(i=e.props).onRelease)===null||r===void 0||r.call(i,e.props.value))},e}return a.prototype.componentDidMount=function(){this.forceUpdate()},a.prototype.render=function(){var e,t=this.props,i=t.className,r=t.disabled,o=t.label,l=t.min,c=t.max,u=t.value,s=t.vertical,m=t.htmlProps,S=this.state.isMoving;return v.exports.createElement("span",H({role:"slider",tabIndex:0},m,{className:I(j,(e={},e[ae]=S,e),i),onKeyDown:r?void 0:this.handleKeyDown,onKeyUp:r?void 0:this.handleKeyUp,onMouseDown:r?void 0:this.beginHandleMovement,onTouchStart:r?void 0:this.beginHandleTouchMovement,ref:this.refHandlers.handle,style:this.getStyleProperties(),"aria-valuemin":l,"aria-valuemax":c,"aria-valuenow":u,"aria-disabled":r,"aria-orientation":s?"vertical":"horizontal"}),o==null?null:v.exports.createElement("span",{className:G},o))},a.prototype.componentWillUnmount=function(){this.removeDocumentEventListeners()},a.prototype.clientToValue=function(e){var t=this.props,i=t.stepSize,r=t.tickSize,o=t.value,l=t.vertical;if(this.handleElement==null)return o;var c=l?window.innerHeight-e:e,u=this.getHandleElementCenterPixel(this.handleElement),s=c-u;return isNaN(s)?o:o+Math.round(s/(r*i))*i},a.prototype.mouseEventClientOffset=function(e){return this.props.vertical?e.clientY:e.clientX},a.prototype.touchEventClientOffset=function(e){var t=e.changedTouches[0];return this.props.vertical?t.clientY:t.clientX},a.prototype.validateProps=function(e){for(var t=0,i=ke;t<i.length;t++){var r=i[t];if(typeof e[r]!="number")throw new Error("[Blueprint] <Handle> requires number value for ".concat(r," prop"))}},a.prototype.changeValue=function(e,t){return t===void 0&&(t=this.props.onChange),e=this.clamp(e),!isNaN(e)&&this.props.value!==e&&(t==null||t(e)),e},a.prototype.clamp=function(e){return q(e,this.props.min,this.props.max)},a.prototype.getHandleElementCenterPixel=function(e){var t=this.getHandleMidpointAndOffset(e),i=t.handleMidpoint,r=t.handleOffset;return r+i},a.prototype.getHandleMidpointAndOffset=function(e,t){if(t===void 0&&(t=!1),e==null)return{handleMidpoint:0,handleOffset:0};var i=this.props.vertical,r=e.getBoundingClientRect();r.width=e.offsetWidth,r.height=e.offsetHeight;var o=i?t?"width":"height":t?"height":"width",l=i?window.innerHeight-(r.top+r[o]):r.left;return{handleMidpoint:r[o]/2,handleOffset:l}},a.prototype.removeDocumentEventListeners=function(){document.removeEventListener("mousemove",this.handleHandleMovement),document.removeEventListener("mouseup",this.endHandleMovement),document.removeEventListener("touchmove",this.handleHandleTouchMovement),document.removeEventListener("touchend",this.endHandleTouchMovement),document.removeEventListener("touchcancel",this.endHandleTouchMovement)},a.displayName="".concat(z,".SliderHandle"),a}(O),ee=function(){return null};ee.displayName="".concat(z,".MultiSliderHandle");var C=function(n){A(a,n);function a(){var e=n!==null&&n.apply(this,arguments)||this;return e.state={labelPrecision:He(e.props),tickSize:0,tickSizeRatio:0},e.handleElements=[],e.trackElement=null,e.addHandleRef=function(t){t!=null&&e.handleElements.push(t)},e.maybeHandleTrackClick=function(t){if(e.canHandleTrackEvent(t)){var i=e.nearestHandleForValue(e.handleElements,function(r){return r.mouseEventClientOffset(t)});i&&i.beginHandleMovement(t)}},e.maybeHandleTrackTouch=function(t){if(e.canHandleTrackEvent(t)){var i=e.nearestHandleForValue(e.handleElements,function(r){return r.touchEventClientOffset(t)});i&&i.beginHandleTouchMovement(t)}},e.canHandleTrackEvent=function(t){var i=t.target;return!e.props.disabled&&i.closest(".".concat(j))==null},e.getHandlerForIndex=function(t,i){return function(r){i==null||i(e.getNewHandleValues(r,t))}},e.handleChange=function(t){var i,r,o=R(e.props),l=o.map(function(c){return c.value});xe(t,l)||((r=(i=e.props).onChange)===null||r===void 0||r.call(i,t),o.forEach(function(c,u){var s;l[u]!==t[u]&&((s=c.onChange)===null||s===void 0||s.call(c,t[u]))}))},e.handleRelease=function(t){var i,r,o=R(e.props);(r=(i=e.props).onRelease)===null||r===void 0||r.call(i,t),o.forEach(function(l,c){var u;(u=l.onRelease)===null||u===void 0||u.call(l,t[c])})},e}return a.getDerivedStateFromProps=function(e){return{labelPrecision:a.getLabelPrecision(e)}},a.getLabelPrecision=function(e){var t=e.labelPrecision,i=e.stepSize;return t==null?Z(i):t},a.prototype.getSnapshotBeforeUpdate=function(e){var t=R(e),i=R(this.props);return i.length!==t.length&&(this.handleElements=[]),null},a.prototype.render=function(){var e,t=this,i=I(X,(e={},e[oe]=this.props.disabled,e["".concat(X,"-unlabeled")]=this.props.labelRenderer===!1,e[le]=this.props.vertical,e),this.props.className);return v.exports.createElement("div",{className:i,onMouseDown:this.maybeHandleTrackClick,onTouchStart:this.maybeHandleTrackTouch},v.exports.createElement("div",{className:se,ref:function(r){return t.trackElement=r}},this.renderTracks()),v.exports.createElement("div",{className:ce},this.renderLabels()),this.renderHandles())},a.prototype.componentDidMount=function(){this.updateTickSize()},a.prototype.componentDidUpdate=function(e,t){n.prototype.componentDidUpdate.call(this,e,t),this.updateTickSize()},a.prototype.validateProps=function(e){if(e.stepSize<=0)throw new Error(he);if(e.labelStepSize!==void 0&&e.labelValues!==void 0)throw new Error(de);if(e.labelStepSize!==void 0&&e.labelStepSize<=0)throw new Error(ue);if(e.min!==void 0&&!isFinite(e.min))throw new Error(me);if(e.max!==void 0&&!isFinite(e.max))throw new Error(fe);var t=!1;if(v.exports.Children.forEach(e.children,function(i){i&&!Q(i,a.Handle)&&(t=!0)}),t)throw new Error(ve)},a.prototype.formatLabel=function(e,t){t===void 0&&(t=!1);var i=this.props.labelRenderer;if(i!==!1)return we(i)?i(e,{isHandleTooltip:t}):e.toFixed(this.state.labelPrecision)},a.prototype.renderLabels=function(){var e=this;if(this.props.labelRenderer===!1)return null;var t=this.getLabelValues(),i=this.props,r=i.max,o=i.min,l=t.map(function(c,u){var s=N((c-o)/(r-o)),m=e.props.vertical?{bottom:s}:{left:s};return v.exports.createElement("div",{className:G,key:u,style:m},e.formatLabel(c))});return l},a.prototype.renderTracks=function(){var e=te(this.props);e.push({value:this.props.max});for(var t={value:this.props.min},i=[],r=0;r<e.length;r++){var o=e[r];i.push(this.renderTrackFill(r,t,o)),t=o}return i},a.prototype.renderTrackFill=function(e,t,i){var r=[this.getOffsetRatio(t.value),this.getOffsetRatio(i.value)].sort(function(h,E){return h-E}),o=r[0],l=r[1],c=N(o),u=N(1-l),s=this.props.vertical?{bottom:c,top:u,left:0}:{left:c,right:u,top:0},m=H(H({},s),t.trackStyleAfter||i.trackStyleBefore||{}),S=I(ge,pe(this.getTrackIntent(t,i)));return v.exports.createElement("div",{key:"track-".concat(e),className:S,style:m})},a.prototype.renderHandles=function(){var e=this,t=this.props,i=t.disabled,r=t.max,o=t.min,l=t.stepSize,c=t.vertical,u=R(this.props);return u.length===0?null:u.map(function(s,m){var S,h=s.value,E=s.type,g=s.className,p=s.htmlProps;return v.exports.createElement(Me,{htmlProps:p,className:I((S={},S[Se]=E===B.START,S[ye]=E===B.END,S),g),disabled:i,key:"".concat(m,"-").concat(u.length),label:e.formatLabel(h,!0),max:r,min:o,onChange:e.getHandlerForIndex(m,e.handleChange),onRelease:e.getHandlerForIndex(m,e.handleRelease),ref:e.addHandleRef,stepSize:l,tickSize:e.state.tickSize,tickSizeRatio:e.state.tickSizeRatio,value:h,vertical:c})})},a.prototype.nearestHandleForValue=function(e,t){return be(e,function(i){var r=t(i),o=i.clientToValue(r),l=i.props.value;return Math.abs(o-l)})},a.prototype.getNewHandleValues=function(e,t){var i=R(this.props),r=i.map(function(s){return s.value}),o=r.slice();o[t]=e,o.sort(function(s,m){return s-m});var l=o.indexOf(e),c=this.findFirstLockedHandleIndex(t,l);if(c===-1)W(o,t,l,e);else{var u=r[c];return W(r,t,c,u),r}return o},a.prototype.findFirstLockedHandleIndex=function(e,t){for(var i=e<t?1:-1,r=R(this.props),o=e+i;o!==t+i;o+=i)if(r[o].interactionKind!==$.PUSH)return o;return-1},a.prototype.getLabelValues=function(){var e=this.props,t=e.labelStepSize,i=e.labelValues,r=e.min,o=e.max,l=[];if(i!==void 0)l=i.slice();else for(var c=r;c<o||Pe(c,o);c+=t!=null?t:1)l.push(c);return l},a.prototype.getOffsetRatio=function(e){return q((e-this.props.min)*this.state.tickSizeRatio,0,1)},a.prototype.getTrackIntent=function(e,t){return this.props.showTrackFill?e.intentAfter!==void 0?e.intentAfter:t!==void 0&&t.intentBefore!==void 0?t.intentBefore:this.props.defaultTrackIntent:D.NONE},a.prototype.updateTickSize=function(){if(this.trackElement!=null){var e=this.props.vertical?this.trackElement.clientHeight:this.trackElement.clientWidth,t=1/(this.props.max-this.props.min),i=e*t;this.setState({tickSize:i,tickSizeRatio:t})}},a.defaultSliderProps={disabled:!1,max:10,min:0,showTrackFill:!0,stepSize:1,vertical:!1},a.defaultProps=H(H({},a.defaultSliderProps),{defaultTrackIntent:D.NONE}),a.displayName="".concat(z,".MultiSlider"),a.Handle=ee,a}(O);function He(n){var a=n.labelPrecision,e=n.stepSize,t=e===void 0?C.defaultSliderProps.stepSize:e;return a==null?Z(t):a}function R(n){return te(n,function(a){return a.interactionKind!==$.NONE})}function te(n,a){var e=n.children;a===void 0&&(a=function(){return!0});var t=v.exports.Children.map(e,function(r){return Q(r,C.Handle)&&a(r.props)?r.props:null}),i=t!=null?t:[];return i=i.filter(function(r){return r!==null}),i.sort(function(r,o){return r.value-o.value}),i}var Re=function(n){A(a,n);function a(){return n!==null&&n.apply(this,arguments)||this}return a.prototype.render=function(){var e=this.props,t=e.initialValue,i=e.intent,r=e.value,o=e.onChange,l=e.onRelease,c=e.handleHtmlProps,u=Ee(e,["initialValue","intent","value","onChange","onRelease","handleHtmlProps"]);return v.exports.createElement(C,H({},u),v.exports.createElement(C.Handle,{value:r,intentAfter:r<t?i:void 0,intentBefore:r>t?i:void 0,onChange:o,onRelease:l,htmlProps:c}),v.exports.createElement(C.Handle,{value:t,interactionKind:"none"}))},a.defaultProps=H(H({},C.defaultSliderProps),{initialValue:0,intent:D.PRIMARY,value:0}),a.displayName="".concat(z,".Slider"),a}(O);let k=0;const Le=(n,a,e,t,i,r,o)=>{const l=n.getContext("2d"),c=n.getBoundingClientRect().top,u=n.getBoundingClientRect().left,s=()=>{i.forEach(g=>{l.lineWidth=2,l.strokeStyle="#0000ff";const p=a+g.left.crop.x,P=c+g.left.crop.y-5-k,y=a+e.width+a+g.right.crop.x,f=c+g.right.crop.y-5-k;l.strokeRect(p,P,g.left.crop.width,g.left.crop.height),l.strokeRect(y,f,g.right.crop.width,g.right.crop.height);const x=p+g.left.crop.width,M=P+g.left.crop.height/2,L=y,T=f+g.right.crop.height/2;l.beginPath(),l.moveTo(x,M),l.lineTo(L,T),l.stroke(),l.closePath()})},m=()=>{l.clearRect(0,0,n.width,n.height),h(),E(),s()};n.addEventListener("wheel",g=>{k=Math.min(Math.max(e.height,t.height)-100,Math.max(0,k+g.deltaY)),m()}),n.addEventListener("mousemove",g=>{g.clientX-u,g.clientY-c});const S=(g,p)=>{var f,x,M,L;if(p==null)return;l.lineWidth=2,l.strokeStyle="#ff0000",p.size==null?p.absolute.x-20:p.absolute.x,p.size==null?p.absolute.y+k-20:p.absolute.y+k;const P=(x=(f=p.size)==null?void 0:f.width)!=null?x:40,y=(L=(M=p.size)==null?void 0:M.height)!=null?L:40;if(!(P<10||y<10)&&p.image!=null){const T=Math.max(0,p.size==null?p.image.x-20:p.image.x),ne=Math.max(0,p.size==null?p.image.y+k-20:p.image.y+k);g({x:T,y:ne,screenY:Math.min(200,p.absolute.y),width:P,height:y})}},h=F(n,l,e,a,20,g=>{S(r,g)},()=>{m()}),E=F(n,l,t,a+e.width+a,20,g=>{S(o,g)},()=>{m()});m()},F=(n,a,e,t,i,r,o)=>{let l=t,c=i,u=e.width,s=e.height;const m=n.getBoundingClientRect().top,S=n.getBoundingClientRect().left;let h=null;const E=(P,y)=>(h={x1:P,x2:P,y1:y,y2:y},(f,x)=>{h.x2=f,h.y2=x,o()});let g;n.addEventListener("mousedown",P=>{const y=P.clientX-S,f=P.clientY-m;if(y>=l-100&&y<=l+u+100&&f>=c-100&&f<=c+s+100){g=E(y,f);return}}),n.addEventListener("mouseup",P=>{if(g!=null&&setTimeout(()=>{g=null}),h!=null){const y=Math.min(h.x1,h.x2),f=Math.min(h.y1,h.y2),x=Math.abs(h.x1-h.x2),M=Math.abs(h.y1-h.y2),L=y-l,T=f-c;h=null,r({image:{x:Math.round(L),y:Math.round(T)},absolute:{x:y,y:f},size:{width:x,height:M}})}}),n.addEventListener("click",P=>{o()}),n.addEventListener("mousemove",P=>{const y=P.clientX-S,f=P.clientY-m;g!=null&&(r(null),g(y,f),o())});const p=()=>{const P=new ImageData(e.resize({width:u,height:s}).getRGBAData({clamped:!0}),u,s);if(a.putImageData(P,l,c-k),a.lineWidth=1,a.strokeStyle="#000000",a.strokeRect(l,c-k,u,s),h!=null){a.lineWidth=2,a.strokeStyle="#0000ff";const y=Math.min(h.x1,h.x2),f=Math.min(h.y1,h.y2),x=Math.abs(h.x1-h.x2),M=Math.abs(h.y1-h.y2);a.strokeRect(y,f,x,M)}};return()=>{p()}},_=(n,a,e)=>n.crop({x:Math.max(0,a.x+e.moveX),y:Math.max(0,a.y+e.moveY),width:a.width-e.shrinkWidth,height:a.height-e.shrinkHeight}).rotate(e.rotate);var U=n=>{var t,i;const[a,e]=v.exports.useState(!1);return v.exports.useEffect(()=>{const r=document.getElementById(n.id),o=r.getContext("2d"),l=_(n.image,{x:n.x,y:n.y,width:n.width,height:n.height},n.postProcess).resize(n.resizeTo);r.width=l.width,r.height=l.height;const c=new ImageData(l.getRGBAData({clamped:!0}),l.width,l.height);o.putImageData(c,0,0),e(!0)},[n.postProcess]),b("div",{className:"bg-white border shadow-md",children:[b("div",{style:{pointerEvents:"all"},className:"flex p-2",onClick:r=>r.stopPropagation(),onMouseDown:r=>r.stopPropagation(),onMouseUp:r=>{r.stopPropagation},children:[d(w,{small:!0,minimal:!0,icon:"arrow-left",onClick:()=>n.setPostProcess({...n.postProcess,moveX:n.postProcess.moveX+1})}),d(w,{small:!0,minimal:!0,icon:"arrow-right",onClick:()=>n.setPostProcess({...n.postProcess,moveX:n.postProcess.moveX-1})}),d(w,{small:!0,minimal:!0,icon:"arrow-down",onClick:()=>n.setPostProcess({...n.postProcess,moveY:n.y-n.postProcess.moveY>0?n.postProcess.moveY-1:n.postProcess.moveY})}),d(w,{small:!0,minimal:!0,icon:"arrow-up",onClick:()=>n.setPostProcess({...n.postProcess,moveY:n.postProcess.moveY+1})}),d(w,{small:!0,minimal:!0,icon:"undo",onClick:()=>n.setPostProcess({...n.postProcess,rotate:n.postProcess.rotate-.1})}),d(w,{small:!0,minimal:!0,icon:"redo",onClick:()=>n.setPostProcess({...n.postProcess,rotate:n.postProcess.rotate+.1})}),d(w,{small:!0,minimal:!0,text:"W-1",onClick:()=>n.setPostProcess({...n.postProcess,shrinkWidth:n.postProcess.shrinkWidth+1})}),d(w,{small:!0,minimal:!0,text:"W+1",onClick:()=>n.setPostProcess({...n.postProcess,shrinkWidth:Math.max(0,n.postProcess.shrinkWidth-1)})}),d(w,{small:!0,minimal:!0,text:"H-1",onClick:()=>n.setPostProcess({...n.postProcess,shrinkHeight:n.postProcess.shrinkHeight+1})}),d(w,{small:!0,minimal:!0,text:"H+1",onClick:()=>n.setPostProcess({...n.postProcess,shrinkHeight:Math.max(0,n.postProcess.shrinkHeight-1)})}),d(w,{small:!0,minimal:!0,icon:"clean",onClick:()=>n.setPostProcess({moveX:0,moveY:0,rotate:0,shrinkHeight:0,shrinkWidth:0})}),d(w,{small:!0,minimal:!0,icon:"cross",onClick:()=>n.removeCrop()})]}),d("canvas",{className:"border m-2",style:{display:a?"block":"none"},id:n.id,width:(t=n.resizeTo.width)!=null?t:n.width,height:(i=n.resizeTo.height)!=null?i:n.height})]})},Ce=n=>{const a=300/Math.max(n.left.width,n.right.width),[e,t]=v.exports.useState(.5),i=(r,o)=>{const c=document.getElementById(r).getContext("2d");c.globalAlpha=.5;const u=o.resize({factor:a}),s=new ImageData(u.getRGBAData({clamped:!0}),u.width,u.height);c.putImageData(s,0,0)};return v.exports.useEffect(()=>{i("left-overlay",n.left),i("right-overlay",n.right)},[n.left,n.right]),b("div",{style:{position:"relative"},children:[b("div",{className:"flex gap-x-2",style:{marginTop:-40,pointerEvents:"all"},children:[d("div",{className:"grow mr-4",children:d(Re,{showTrackFill:!1,labelRenderer:()=>d(J,{}),value:e,min:0,max:1,stepSize:.05,onChange:r=>{t(r)}})}),d(w,{icon:"tick",text:"Add",intent:"primary",onClick:()=>{n.save()}})]}),d("canvas",{style:{position:"absolute",opacity:1-e,top:0,left:0},className:"border m-2 bg-white p-2",id:"left-overlay",width:Math.max(n.left.width,n.right.width)*a,height:Math.max(n.left.height,n.right.height)*a}),d("canvas",{style:{position:"absolute",opacity:e,top:0,left:0},className:"border m-2 bg-white p-2",id:"right-overlay",width:Math.max(n.left.width,n.right.width)*a,height:Math.max(n.left.height,n.right.height)*a})]})},Te=n=>b("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"},children:[n.left.crop!=null&&d("div",{style:{position:"absolute",top:Math.min(200,n.left.crop.screenY),left:n.padding-30},children:d(U,{id:"crop-left",postProcess:n.left.postprocess,setPostProcess:n.left.setPostProcess,resizeTo:{width:n.left.image.width+60},image:n.left.image,...n.left.crop,removeCrop:()=>{n.removeLeft()}})}),n.right.crop!=null&&d("div",{style:{position:"absolute",top:Math.min(200,n.right.crop.screenY),left:n.padding+n.left.image.width+n.padding-30},children:d(U,{id:"crop-right",postProcess:n.right.postprocess,setPostProcess:n.right.setPostProcess,resizeTo:{width:n.right.image.width+60},image:n.right.image,...n.right.crop,removeCrop:()=>{n.removeRight()}})}),n.left.crop!=null&&n.right.crop!=null&&d("div",{className:"flex justify-center",style:{position:"absolute",left:0,bottom:300,width:"100%"},children:d(Ce,{save:n.save,left:_(n.left.image,n.left.crop,n.left.postprocess),right:_(n.right.image,n.right.crop,n.right.postprocess)})})]}),Ie=n=>{var g,p,P,y;const[a,e]=v.exports.useState(null),[t,i]=v.exports.useState(null),r=f=>{f==null?e(null):e(f)},o=f=>{f==null?i(null):i(f)},[l,c]=v.exports.useState(null),u=()=>{const f=localStorage.getItem("left-proc");return f!=null&&f!=""?JSON.parse(f):null},s=()=>{const f=localStorage.getItem("right-proc");return f!=null&&f!=""?JSON.parse(f):null},[m,S]=v.exports.useState((p=(g=u())==null?void 0:g.postLeft)!=null?p:{shrinkWidth:0,shrinkHeight:0,moveX:0,moveY:0,rotate:0}),[h,E]=v.exports.useState((y=(P=s())==null?void 0:P.postRight)!=null?y:{shrinkWidth:0,shrinkHeight:0,moveX:0,moveY:0,rotate:0});return v.exports.useEffect(()=>{const f=u();f!=null&&(e(f.selectedLeft),S(f.postLeft));const x=s();x!=null&&(i(x.selectedRight),E(x.postRight))},[]),v.exports.useEffect(()=>{localStorage.setItem("left-proc",JSON.stringify({selectedLeft:a,postLeft:m})),localStorage.setItem("right-proc",JSON.stringify({selectedRight:t,postRight:h}))},[a,m,t,h]),v.exports.useEffect(()=>{n.edit==null?(E({shrinkWidth:0,shrinkHeight:0,moveX:0,moveY:0,rotate:h.rotate}),S({shrinkWidth:0,shrinkHeight:0,moveX:0,moveY:0,rotate:m.rotate})):(S(n.edit.left.postProcess),E(n.edit.right.postProcess),e(n.edit.left.crop),i(n.edit.right.crop))},[n.edit]),v.exports.useEffect(()=>{const f=document.getElementById("canvas");let x=(f.width-n.left.width-n.right.width)/3;Le(f,x,n.left.rotate(m.rotate),n.right.rotate(h.rotate),n.pairs,r,o),c(x)},[m.rotate,h.rotate,n.pairs]),b("div",{className:"flex justify-center",style:{position:"relative"},children:[d("canvas",{id:"canvas",className:"border",width:window.innerWidth,height:window.innerHeight-50}),l!=null&&d(Te,{save:()=>{n.add({left:{crop:a,postProcess:m},right:{crop:t,postProcess:h}}),E({shrinkWidth:0,shrinkHeight:0,moveX:0,moveY:0,rotate:h.rotate}),S({shrinkWidth:0,shrinkHeight:0,moveX:0,moveY:0,rotate:m.rotate}),e(null),i(null)},padding:l,left:{image:n.left.rotate(m.rotate),setPostProcess:S,postprocess:m,crop:a},right:{image:n.right.rotate(h.rotate),setPostProcess:E,postprocess:h,crop:t},removeLeft:()=>{e(null),S({shrinkWidth:0,shrinkHeight:0,moveX:0,moveY:0,rotate:m.rotate})},removeRight:()=>{i(null),E({shrinkWidth:0,shrinkHeight:0,moveX:0,moveY:0,rotate:h.rotate})}})]})},K=n=>{const a=25/Math.max(n.image.width,n.image.width);return v.exports.useEffect(()=>{const t=document.getElementById(n.id).getContext("2d"),i=n.image.resize({factor:a}),r=new ImageData(i.getRGBAData({clamped:!0}),i.width,i.height);t.putImageData(r,0,0)},[]),d("div",{style:{position:"relative"},children:d("canvas",{id:n.id,className:"border bg-white p-2",width:n.image.width*a,height:n.image.height*a})})},Ne=n=>{const[a,e]=v.exports.useState(n.left),[t,i]=v.exports.useState(n.right),r=()=>{const s=localStorage.getItem("stored-pairs");return s==null||s==""?[]:JSON.parse(s)},[o,l]=v.exports.useState(null),[c,u]=v.exports.useState(r());return v.exports.useEffect(()=>{localStorage.setItem("stored-pairs",JSON.stringify(c))},[c]),b("div",{className:"border-b bg-slate-50 shadow-md",children:[b("div",{className:"flex",children:[d("div",{className:"w-[20%] text-center"}),a!=null&&d("div",{className:"w-[20%] text-center",children:d(w,{text:"Remove",icon:"small-cross",minimal:!0,onClick:()=>{localStorage.removeItem("left"),e(null)}})}),d("div",{className:"w-[20%] text-center"}),d("div",{className:"w-[20%] text-center",children:t!=null&&d(w,{text:"Remove",icon:"small-cross",minimal:!0,onClick:()=>{localStorage.removeItem("right"),localStorage.removeItem("right-proc"),u([]),l(null),i(null)}})}),d("div",{className:"w-[20%] text-center"})]}),(a==null||t==null)&&b("div",{className:"flex",children:[d("div",{className:"grow",children:d(Y,{existing:n.left,onSelect:async s=>{s==null?(localStorage.removeItem("left"),localStorage.removeItem("left-proc")):localStorage.setItem("left",await s.toBase64())}})}),d("div",{className:"grow",children:d(Y,{existing:n.right,onSelect:async s=>{s==null?(localStorage.removeItem("right"),localStorage.removeItem("right-proc")):localStorage.setItem("right",await s.toBase64())}})})]}),a!=null&&t!=null&&b("div",{className:"bg-slate-100",children:[d(Ie,{edit:o==null?null:c[o],left:a,right:t,pairs:c,add:s=>{if(o==null)u([...c,s]);else{const m=[...c];m[o]=s,u(m)}l(null)}}),b("div",{style:{position:"absolute",top:40,left:20},children:[c.map((s,m)=>b("div",{className:"flex gap-x-2 items-center mb-2 border bg-white p-2 px-3",children:[d(K,{id:m+"-0",image:a.rotate(s.left.postProcess.rotate).crop({x:s.left.crop.x,y:s.left.crop.y,width:s.left.crop.width,height:s.left.crop.height})}),d(K,{id:m+"-1",image:t.rotate(s.right.postProcess.rotate).crop({x:s.right.crop.x,y:s.right.crop.y,width:s.right.crop.width,height:s.right.crop.height})}),d(w,{icon:"edit",onClick:()=>{l(m)}}),d(w,{icon:"trash",onClick:()=>{const S=[...c];S.splice(m,1),u(S)}})]},m)),d("div",{className:"mt-4 text-center",children:d(w,{text:"Compare images",intent:c.length>1?"primary":"none",onClick:()=>{n.compare(c)}})})]})]})]})},Ae=n=>{var u,s,m,S;const a=()=>{const h=localStorage.getItem("state");return h==null||h==""?null:JSON.parse(h)},[e,t]=v.exports.useState((s=(u=a())==null?void 0:u.state)!=null?s:"prepare"),[i,r]=v.exports.useState((S=(m=a())==null?void 0:m.anchors)!=null?S:[]);v.exports.useEffect(()=>{localStorage.setItem("state",JSON.stringify({state:e,anchors:i}))},[e,i]);const[o,l]=v.exports.useState(null),c=async()=>{const h=localStorage.getItem("left"),E=localStorage.getItem("right");let g=null,p=null;h!=null&&h!=""&&(g=await V({imageBase64:h})),E!=null&&E!=""&&(p=await V({imageBase64:E})),l({left:g,right:p})};return v.exports.useEffect(()=>{c()},[]),d("div",{children:o!=null&&b(J,{children:[e=="prepare"&&d(Ne,{left:o.left,right:o.right,compare:h=>{r(h),t("compare")}}),e=="compare"&&o.left!=null&&o.right!=null&&d(ie,{left:o.left,right:o.right,anchors:i,edit:()=>{t("prepare")}})]})})};export{Ae as default};
