import{r as s,a as N,j as i}from"./app.9f0e5155.js";import{P as R,C as z,I as L}from"./CompareImages.984f2c3a.js";import{Q as P}from"./qr-scanner.min.df159b6a.js";import{a as A}from"./data.cf941f40.js";import"./buttons.e708479d.js";const Q=async(e,n)=>{const c=e.height>e.width?{x:0,y:Math.floor(e.height-e.height/8),width:e.width,height:Math.floor(e.height/8)}:{x:Math.floor(e.width-e.width/8),y:0,width:Math.floor(e.width/8),height:e.height},h=e.crop(c).resize({width:600});return new Promise(async(o,v)=>{P.scanImage(await h.toBlob(),{}).then(t=>{o({crop:h,code:t.data})}).catch(t=>{n<4?Q(e.rotate(90),n+1):o({crop:h,code:null})})})};var _=e=>{var S,x,w,I;const n=()=>{const r=localStorage.getItem("state");return r==null||r==""?null:JSON.parse(r)},[c,h]=s.exports.useState((x=(S=n())==null?void 0:S.state)!=null?x:"prepare"),[o,v]=s.exports.useState((I=(w=n())==null?void 0:w.anchors)!=null?I:[]);s.exports.useEffect(()=>{localStorage.setItem("state",JSON.stringify({state:c,anchors:o}))},[c,o]);const[t,u]=s.exports.useState({left:null,right:null}),[J,f]=s.exports.useState(null),[p,g]=s.exports.useState(null),[m,C]=s.exports.useState(null),j=r=>{const d=r.split("!")[0],[l,y,O]=d.split(".").map(a=>parseInt(a)),M=A.find(a=>parseInt(a.Centro)==l&&parseInt(a.Mesa)==y);if(M==null){g(`Lo sient, no tengo la acta por centro ${l}, mesa ${y}`);return}f("Loading same acta from resultadosconvzla.com..."),L.load(M.url.replace("https://static.resultadosconvzla.com","http://localhost:8000/static")).then(a=>{u({...t,right:a})})},E=async(r,d)=>{g(null),f("Reading QR code...");const l=await Q(r,d);C(l.crop),l.code!=null&&j(l.code)};return s.exports.useEffect(()=>{(t==null?void 0:t.left)!=null&&t.right==null&&E(t==null?void 0:t.left,1)},[t]),N("div",{className:"p-3 text-center",children:[p&&i("div",{className:"p-3",children:p}),t.left==null&&i(R,{existing:null,full:!0,onSelect:async r=>{u({left:r,right:null})}}),p!=null&&m!=null&&i("img",{width:400,src:m.toDataURL()}),t.left!=null&&t.right!=null&&i(z,{left:t.left,right:t.right,anchors:o,edit:()=>{u({left:null,right:null})}})]})};export{_ as default,Q as getQr};
